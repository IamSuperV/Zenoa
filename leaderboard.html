<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Rankings - ZENOA</title>
    <link rel="stylesheet" href="styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --gold-primary: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.5);
            --dark-bg: #0a0a0a;
            --glass-bg: rgba(20, 20, 20, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: #000 url('https://images.unsplash.com/photo-1634152962476-4b8a00e1915c?q=80&w=2069&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Rajdhani', sans-serif;
            color: #fff;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: -1;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 2rem;
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--gold-primary);
            text-shadow: 0 0 15px var(--gold-glow);
            letter-spacing: 2px;
        }

        .btn-glow {
            background: transparent;
            border: 1px solid var(--gold-primary);
            color: var(--gold-primary);
            padding: 0.5rem 1.5rem;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .btn-glow:hover {
            background: var(--gold-primary);
            color: #000;
            box-shadow: 0 0 20px var(--gold-glow);
        }

        /* TITLE SECTION */
        .page-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-title h1 {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            background: linear-gradient(180deg, #fff, #999);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            letter-spacing: 4px;
        }

        .page-title p {
            color: var(--gold-primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 1rem;
            margin-top: 0.5rem;
            opacity: 0.8;
            text-shadow: 0 0 10px var(--gold-glow);
        }

        /* TABS */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .tab-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--glass-border);
            color: #888;
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
        }

        .tab-btn.active {
            color: #fff;
            border-color: var(--gold-primary);
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.1), rgba(0, 0, 0, 0));
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        /* FILTER DROPDOWN */
        #filter-select {
            background: #000;
            color: var(--gold-primary);
            border: 1px solid var(--gold-primary);
            padding: 0.8rem 2rem;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            text-transform: uppercase;
            outline: none;
            width: 300px;
            text-align: center;
            margin-bottom: 2rem;
        }

        /* LEADERBOARD CARDS */
        .rank-card {
            display: flex;
            align-items: center;
            padding: 1.2rem;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03), rgba(0, 0, 0, 0.6));
            border-left: 3px solid transparent;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .rank-card:hover {
            transform: scale(1.02);
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.8));
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* Rank 1 (Gold) */
        .rank-1 {
            border-left: 3px solid var(--gold-primary);
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(0, 0, 0, 0.8));
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }

        .rank-1 .rank-display {
            color: var(--gold-primary);
            font-size: 2.5rem;
            text-shadow: 0 0 15px var(--gold-glow);
        }

        .rank-1::after {
            content: 'ðŸ‘‘';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            opacity: 0.1;
        }

        /* Rank 2 (Silver) */
        .rank-2 {
            border-left: 3px solid #C0C0C0;
            background: linear-gradient(90deg, rgba(192, 192, 192, 0.1), rgba(0, 0, 0, 0.8));
        }

        .rank-2 .rank-display {
            color: #C0C0C0;
            font-size: 2rem;
        }

        /* Rank 3 (Bronze) */
        .rank-3 {
            border-left: 3px solid #CD7F32;
            background: linear-gradient(90deg, rgba(205, 127, 50, 0.1), rgba(0, 0, 0, 0.8));
        }

        .rank-3 .rank-display {
            color: #CD7F32;
            font-size: 1.8rem;
        }

        /* Default Ranks */
        .rank-display {
            width: 60px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: #555;
            margin-right: 1.5rem;
            font-family: 'Cinzel', serif;
        }

        .hex-avatar {
            width: 50px;
            height: 50px;
            background: #222;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-detail {
            font-size: 0.9rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .score-display {
            text-align: right;
        }

        .xp-val {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gold-primary);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            font-family: 'Rajdhani', sans-serif;
        }

        .xp-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
        }

        /* Tier Badges */
        .badge-pill {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.1);
            color: #aaa;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .badge-gold {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
            background: rgba(255, 215, 0, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="overlay"></div>
    <div class="container">
        <header>
            <div class="logo">ZENOA</div>
            <a href="dashboard.html" class="btn-glow">Return to Base</a>
        </header>

        <div class="page-title">
            <h1>DOMINANCE HIERARCHY</h1>
            <p>Measure Your Decision-Making Intelligence</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" id="tab-global" data-tab="Global">Global</button>
            <button class="tab-btn" id="tab-college" data-tab="College">College</button>
            <button class="tab-btn" id="tab-city" data-tab="City">City</button>
        </div>

        <div id="filter-container" class="hidden" style="text-align: center;">
            <select id="filter-select">
                <option value="">Select Sector...</option>
            </select>
        </div>

        <div id="leaderboard-container">
            <div style="text-align: center; padding: 4rem; opacity: 0.5;">Accessing Global Database...</div>
        </div>
    </div>

    <script type="module">
        import { subscribeToLeaderboard } from './js/leaderboard.js';
        import { generateFakeUsers, INDIAN_COLLEGES, INDIAN_CITIES } from './js/fake_users.js';

        let currentTab = 'Global';
        let currentFilter = null;
        let unsubscribe = null;

        // Generate dataset once
        const FAKE_DATABASE = generateFakeUsers();

        // Populate Filters on Load
        const COLLEGES_SORTED = [...INDIAN_COLLEGES].sort();
        const CITIES_SORTED = [...INDIAN_CITIES].sort();

        initLeaderboard('Global');

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');

                currentTab = e.target.dataset.tab;
                const filterCont = document.getElementById('filter-container');
                const sel = document.getElementById('filter-select');

                if (currentTab === 'Global') {
                    filterCont.classList.add('hidden');
                    initLeaderboard('Global');
                } else {
                    filterCont.classList.remove('hidden');
                    if (currentTab === 'College') populateFilters(COLLEGES_SORTED);
                    else if (currentTab === 'City') populateFilters(CITIES_SORTED);

                    // Clear previous view
                    stopListening();
                    document.getElementById('leaderboard-container').innerHTML = `<div style="text-align: center; padding: 3rem; color: var(--text-secondary);">Select a ${currentTab} to view rankings.</div>`;
                }
            });
        });

        document.getElementById('filter-select').addEventListener('change', (e) => {
            if (e.target.value) {
                initLeaderboard(currentTab, e.target.value);
            }
        });

        function populateFilters(options) {
            const sel = document.getElementById('filter-select');
            sel.innerHTML = '<option value="">Select...</option>';
            options.forEach(o => {
                const opt = document.createElement('option');
                opt.value = o;
                opt.textContent = o;
                sel.appendChild(opt);
            });
        }

        function stopListening() {
            if (unsubscribe) {
                unsubscribe();
                unsubscribe = null;
            }
        }

        function initLeaderboard(type, filterVal = null) {
            const container = document.getElementById('leaderboard-container');
            container.innerHTML = '<div style="text-align: center; padding: 4rem;">Accessing Global Database...</div>';

            stopListening();

            unsubscribe = subscribeToLeaderboard(
                type,
                filterVal,
                'totalScore',
                (realUsers) => {
                    // 1. Get Fake Users corresponding to this view
                    let fakeSubset = FAKE_DATABASE;

                    if (type === 'College' && filterVal) {
                        fakeSubset = FAKE_DATABASE.filter(u => u.college === filterVal);
                    } else if (type === 'City' && filterVal) {
                        fakeSubset = FAKE_DATABASE.filter(u => u.city === filterVal);
                    }

                    // 2. Normalize and Merge
                    // Real users have displayScore, Fake users have score
                    const normalizedReal = realUsers.map(u => ({ ...u, score: u.displayScore || 0 }));
                    const normalizedFake = fakeSubset.map(u => ({ ...u, displayScore: u.score || 0 }));

                    const combined = [...normalizedReal, ...normalizedFake];

                    // 3. Sort Descending
                    combined.sort((a, b) => b.score - a.score);

                    // 4. Limit to Top 100 for display performance
                    const top100 = combined.slice(0, 100);

                    renderLeaderboard(top100, container);
                },
                (error) => {
                    console.error(error);
                    container.innerHTML = `<div style="text-align: center; padding: 2rem; color: var(--danger-color);">Connection Lost. Retrying...</div>`;
                }
            );
        }

        function renderLeaderboard(users, container) {
            if (users.length === 0) {
                container.innerHTML = `<div style="text-align: center; padding: 4rem; color: #666; font-family: 'Rajdhani';">NO OPERATIVES FOUND IN THIS SECTOR.</div>`;
                return;
            }

            container.innerHTML = '';
            users.forEach((u, index) => {
                const rank = index + 1;

                // Styling Top 3
                let rankClass = '';
                if (rank === 1) rankClass = 'rank-1';
                else if (rank === 2) rankClass = 'rank-2';
                else if (rank === 3) rankClass = 'rank-3';

                const div = document.createElement('div');
                div.className = `rank-card ${rankClass}`;

                // Tier Badge
                const tier = u.tier || 'BRONZE';
                const tierClass = tier === 'GOLD' || tier === 'LEGEND' || tier === 'CHAMPION' ? 'badge-gold' : 'badge-pill';

                div.innerHTML = `
    <div class="rank-display">#${rank}</div>
    <div class="hex-avatar">
        <span style="font-size: 1.5rem;">ðŸ‘¤</span>
    </div>
    <div class="player-info">
        <div class="player-name">
            ${u.username}
            <span class="badge-pill ${tierClass}">${tier}</span>
        </div>
        <div class="player-detail">
            ${u.dominantType || 'Unknown Style'} â€¢ ${u.college || u.city || 'Unknown Location'}
        </div>
    </div>
    <div class="score-display">
        <div class="xp-val">${Math.floor(u.displayScore)}</div>
        <div class="xp-label">INTEL XP</div>
    </div>
    `;
                container.appendChild(div);
            });
        }
    </script>
</body>

</html>